{% extends 'KitpagesCmsBundle:Page:layout.html.twig' %}
{% block body %}
    <script type="text/javascript" src="{{ asset ("bundles/kitpagescms/js/jQuery/kitCmsModal.js") }}" ></script>
    <script>
        $(document).ready(function() {
            $('.kit-cms-modal-open > a').kitCmsModal({closable:false});
            $('a.kit-cms-modal-open').kitCmsModal({closable:false});
        });
    </script>
    <div class="kit-cms-tree kit-cms">
        <h1>Tree</h1>
        <a class="kit-cms-modal-open kit-cms-publish-all" href="{{ path('kitpages_cms_nav_publish_all', { 'kitpages_target' : path('kitpages_cms_nav_tree') }) }}">
            <img src="{{asset("bundles/kitpagescms/icon/publish.png")}}"/> Publish all pages and navigation
        </a>
        <script>
            $('.kit-cms-publish-all').click(function(e) {
                var response = confirm("Do you confirm you want to publish all pages and the navigation ?");
                if (!response) {
                    e.preventDefault();
                }
            });
        </script>

        {% set cycle = 0 %}
    {% include 'KitpagesCmsBundle:Nav:treeChildren.html.twig' with {'tree': tree, 'kitCmsUserPreferenceTree': kitCmsUserPreferenceTree } %}
    <script>
    (function(){

        $('.kit-cms-tree-hide').hide();
        $(window).scrollTop({{kitCmsUserPreferenceTree.scrollTree|default(0)}});
        var timer;
        $(window).scroll(function () {
            clearTimeout(timer);
            timer = setTimeout(
                function(){$.ajax({
                  url: "{{ path('kitpages_cms_nav_userpreference_tree_scroll')}}?scroll="+$(window).scrollTop()
                })},
                1000
            );
        });
        $('.kit-cms-tree').delegate('.kit-cms-tree-expanded-collapsed', 'click', function(event){
            $(this).nextAll('div.kit-cms-tree-state-node').toggle();
            $(this).siblings('.kit-cms-tree-expanded-collapsed').toggle();
            $(this).toggle();
            $.ajax({
              url: $(this).attr('data-cms-tree-action-url'),
              success: function(){
              }
            });
        })
    })();
    </script>
    </div>
{% endblock body %}
